#include "led_helper.h"
#include "stdio.h"
#include "ssd1306.h"

typedef enum {
	LED_IDLE = 0x00U,
	LED_ALL = 0x01U,
	LED_TEMP = 0x02U,
	LED_HEARTH = 0x03U,
	LED_OXYGEN = 0x04U
} LED_STATUS;

uint16_t LED_STATUS_COUNT = 2;

char led_buffer[];

LED_STATUS led_status;

const unsigned char pribor_64x64[] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfd, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xfb, 0x9f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf7,
		0xef, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xef, 0xf7, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xbf, 0xfd, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f,
		0xfe, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff, 0x7f, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xbf, 0xff, 0xbf, 0xff, 0xff, 0xff, 0xff, 0xf1, 0xff,
		0xff, 0xcf, 0xff, 0xff, 0xff, 0xff, 0xce, 0xf7, 0xff, 0xf7, 0xff, 0xff,
		0xff, 0xff, 0xff, 0x7b, 0xff, 0xfb, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xdd,
		0xff, 0xfe, 0xff, 0xff, 0xff, 0xfe, 0xff, 0xef, 0x7f, 0xff, 0x7f, 0xff,
		0xff, 0xf9, 0xff, 0xfb, 0xbf, 0xff, 0x9f, 0xff, 0xff, 0xfd, 0xff, 0xfd,
		0xef, 0xff, 0xbf, 0xff, 0xff, 0xfe, 0xff, 0xfe, 0xff, 0xff, 0x7f, 0xff,
		0xff, 0xf7, 0x7f, 0xff, 0xef, 0xfe, 0xdf, 0xff, 0xff, 0xfb, 0xbf, 0xff,
		0x9f, 0xfd, 0xbf, 0xff, 0xff, 0xf5, 0x6f, 0xff, 0xff, 0xf6, 0x9f, 0xff,
		0xff, 0xfa, 0xb7, 0xff, 0xff, 0xed, 0x3f, 0xff, 0xff, 0xf5, 0x7b, 0xff,
		0xff, 0xd8, 0x9f, 0xff, 0xff, 0xfa, 0x9e, 0xff, 0xff, 0x75, 0x3f, 0xff,
		0xff, 0xf5, 0x57, 0x7f, 0xfe, 0xc8, 0x9f, 0xff, 0xff, 0xfa, 0xa9, 0xbf,
		0xfd, 0xa5, 0x3f, 0xff, 0xff, 0xf5, 0x56, 0xef, 0xf6, 0x10, 0x9f, 0xff,
		0xff, 0xfa, 0xa9, 0xb7, 0xee, 0xa5, 0x3f, 0xff, 0xff, 0xf5, 0x56, 0x7b,
		0x98, 0x48, 0x9f, 0xff, 0xff, 0xfa, 0xa9, 0x9c, 0xf2, 0x92, 0x5f, 0xff,
		0xff, 0xf5, 0x55, 0x47, 0xc8, 0x45, 0x3f, 0xff, 0xff, 0xfa, 0xaa, 0xb5,
		0xa5, 0x28, 0x9f, 0xff, 0xff, 0xf5, 0x55, 0x55, 0x90, 0x84, 0x5f, 0xff,
		0xff, 0xfa, 0xaa, 0xab, 0xca, 0x52, 0x9f, 0xff, 0xff, 0xf5, 0x56, 0xab,
		0x91, 0x29, 0x3f, 0xff, 0xff, 0xfa, 0xae, 0xa9, 0xa4, 0xe4, 0x5f, 0xff,
		0xff, 0xf5, 0x57, 0x57, 0x92, 0x72, 0x9f, 0xff, 0xff, 0xfa, 0xae, 0xa9,
		0xc9, 0x68, 0x5f, 0xff, 0xff, 0xf5, 0x57, 0x55, 0xa4, 0xe5, 0x3f, 0xff,
		0xff, 0xfa, 0xae, 0xab, 0x91, 0x71, 0x1f, 0xff, 0xff, 0xf5, 0x57, 0x55,
		0xc4, 0x64, 0xbf, 0xff, 0xff, 0xfa, 0xae, 0xab, 0x92, 0xea, 0x5f, 0xff,
		0xff, 0xf5, 0x56, 0xa9, 0xa8, 0x61, 0x1f, 0xff, 0xff, 0xfa, 0xaf, 0x57,
		0x85, 0x74, 0xbf, 0xff, 0xff, 0xf5, 0x56, 0xa9, 0xd2, 0xea, 0x1f, 0xff,
		0xff, 0xfa, 0xaf, 0x55, 0x88, 0x61, 0x5f, 0xff, 0xff, 0xf5, 0x56, 0xab,
		0xa5, 0x74, 0x9f, 0xff, 0xff, 0xfe, 0xaf, 0x55, 0xa8, 0xe2, 0x7f, 0xff,
		0xff, 0xfe, 0xae, 0xab, 0x85, 0x69, 0x7f, 0xff, 0xff, 0xff, 0xa6, 0xab,
		0xd0, 0x6a, 0xff, 0xff, 0xff, 0xff, 0xdf, 0x55, 0x8a, 0xe5, 0xff, 0xff,
		0xff, 0xff, 0xee, 0xab, 0xa4, 0x77, 0xff, 0xff, 0xff, 0xff, 0xfe, 0xa9,
		0x92, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x57, 0xa4, 0x7f, 0xff, 0xff,
		0xff, 0xff, 0xfe, 0xa9, 0x92, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x55,
		0xc9, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xd7, 0xa5, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xe9, 0x97, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfb,
		0xcf, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfd, 0xbf, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xff, 0xfb, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff };

void led_init() {
	ssd1306_Init();
	led_status = LED_ALL;
}

void led_update(uint8_t t, uint8_t h, uint8_t o) {

	ssd1306_Fill(Black);

	ssd1306_SetCursor(0, 0);
	ssd1306_WriteString("Temp C", Font_6x8, White);
	ssd1306_SetCursor(0, 10);
	sprintf(led_buffer, "%d", (uint8_t) t);
	ssd1306_WriteString(led_buffer, Font_7x10, White);

	ssd1306_SetCursor(0, 22);
	ssd1306_WriteString("Pulse", Font_6x8, White);
	ssd1306_SetCursor(0, 32);
	sprintf(led_buffer, "%d", (uint8_t) h);
	ssd1306_WriteString(led_buffer, Font_7x10, White);

	ssd1306_SetCursor(0, 44);
	ssd1306_WriteString("Oxygen", Font_6x8, White);
	ssd1306_SetCursor(0, 54);
	sprintf(led_buffer, "%d", (uint8_t) o);
	ssd1306_WriteString(led_buffer, Font_7x10, White);

	ssd1306_UpdateScreen();
}

void inc_led_status() {
	led_status++;
	led_status %= LED_STATUS_COUNT;
}

void led_pribor() {
	ssd1306_Fill(White);
	ssd1306_DrawBitmap(0, 0, pribor_64x64, 64, 64, Black);
	ssd1306_UpdateScreen();
}

